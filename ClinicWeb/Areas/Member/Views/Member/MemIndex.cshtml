@model IEnumerable<ClinicWeb.Areas.Member.ViewModels.MemberViewModel>
@* @model ClinicWeb.Areas.Member.ViewModels.MemberViewModel *@


@section ModulesStyles
{
    <!-- iCheck -->
    <link href="~/vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- Datatables -->

    <link href="~/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="~/vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css" rel="stylesheet">
    <link href="~/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css" rel="stylesheet">
    <link href="~/vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css" rel="stylesheet">
    <link href="~/vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css" rel="stylesheet">

    <!-- bootstrap-wysiwyg -->
    <link href="~/vendors/google-code-prettify/bin/prettify.min.css" rel="stylesheet">
    <!-- Select2 -->
    <link href="~/vendors/select2/dist/css/select2.min.css" rel="stylesheet">
    <!-- Switchery -->
    <link href="~/vendors/switchery/dist/switchery.min.css" rel="stylesheet">
    <!-- starrr -->
    <link href="~/vendors/starrr/dist/starrr.css" rel="stylesheet">
    <!-- bootstrap-daterangepicker -->
    <link href="~/vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
}
<div class="x_panel">
    <!--文字會員資料表處那排-->
    <div class="x_title">
        <h2>會員資料表 </h2>

        <ul class="nav navbar-right panel_toolbox">
            <li>
                <a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
            </li>

            <li>
                <a class="close-link"><i class="fa fa-close"></i></a>
            </li>
        </ul>
        <div class="clearfix"></div>
    </div>
    <!--搜尋那塊-->
    <div style="margin:20px" class="x_content">
        <div class="row">
            <div class="col-sm-12">
                <div class="card-box table-responsive">

                    <div id="datatable_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap no-footer">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="dataTables_length" id="datatable_length">
                                </div>
                            </div>

                        </div>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#MemCreate">新增會員</button>

                        <div class="modal fade" id="MemCreate" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <partial name="~/Areas/Member/Views/Partial/_MemberCreatePartial.cshtml" />
                                </div>
                            </div>
                        </div>









                        @*  MemEdit為了打開彈跳視窗 *@
                        <div class="modal fade" id="MemEdit" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">

                            <div class="modal-dialog modal-lg">
                                @*  memberedit為了填入過來的資料 *@
                                <div class="modal-content" id="memberedit">

                                </div>
                            </div>
                        </div>
                                <div class="row">


                                    <!--表格處-->
                                    <div class="col-sm-12">
                                        <table id="memdatatable" class="table table-striped table-bordered dataTable no-footer" style="width: 100%;" role="grid" aria-describedby="datatable_info">
                                            <thead>
                                                <tr>
                                                    <th style="display:none">
                                                        會員id
                                                    </th>
                                                    <th>
                                                        會員編號
                                                        @*  @Html.DisplayNameFor(model => model.MemberNumber) *@
                                                    </th>
                                                    <th>
                                                        姓名
                                                        @*  @Html.DisplayNameFor(model => model.Name) *@
                                                    </th>
                                                    <th>
                                                        性別
                                                        @* @Html.DisplayNameFor(model => model.Gender) *@
                                                    </th>
                                                    <th>
                                                        血型
                                                        @* @Html.DisplayNameFor(model => model.BloodType) *@
                                                    </th>
                                                    <th>
                                                        身分證字號
                                                    </th>
                                                    <th>
                                                        聯絡電話
                                                        @*  @Html.DisplayNameFor(model => model.NationalId) *@
                                                    </th>
                                                    <th>
                                                        地址
                                                        @*  @Html.DisplayNameFor(model => model.Address) *@
                                                    </th>

                                                    <th>
                                                        緊急聯絡人
                                                        @* @Html.DisplayNameFor(model => model.Phone) *@
                                                    </th>
                                                    <th>
                                                        信箱
                                                        @* @Html.DisplayNameFor(model => model.BirthDate) *@
                                                    </th>
                                                    <th>
                                                        啟用
                                                        @*  @Html.DisplayNameFor(model => model.MemberNumber) *@
                                                    </th>
                                                    <th style="text-align">
                                                        修改
                                                        <div id="partialContainer"></div>

                                                    </th>
                                                </tr>


                                            </thead>




                                        </table>
                                    </div>
                                </div>
                                <div class="row">




                                    <li class="paginate_button next" id="datatable_next"><a href="#" aria-controls="datatable" data-dt-idx="7" tabindex="0"></a></li>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        @section Scripts {
            <script>
                function QueryMemberInfo() {
                    $('#memdatatable').dataTable({
                        ajax: {
                            type: 'GET',
                            url: ("/Member/Member/MemberGetdata"),
                            dataSrc: function (json) { return json; }
                        },
                        destroy: true,
                        columns: [
                            // { "data": "id", "visible": false },
                            { "data": "會員id", "visible": false },
                            { "data": "會員編號" },
                            { "data": "姓名" },

                            { "data": "性別" },
                            { "data": "血型" },
                            { "data": "身分證字號" },
                            { "data": "聯絡電話" },
                            { "data": "地址" },
                            { "data": "緊急聯絡人" },
                            { "data": "信箱" },
                            { "data": "啟用" },
                            {
                                "data": "修改", "render": function (data, type, row) {
                                    return '<button type="button" class="btn btn-primary" data-target="#MemEdit" onclick="handleButtonClick(' + row.會員id + ')">修改</button>';
                                }
                            }


                        ],
                        fixedHeader: {
                            header: true
                        },
                        language: {
                            url: "https://cdn.datatables.net/plug-ins/1.13.7/i18n/zh-HANT.json"
                        },
                        order: [[1, 'asc']]
                    });

                }
                QueryMemberInfo();

            </script>
        }

        @section Modules
        {
            <!-- iCheck -->
            <script src="~/vendors/iCheck/icheck.min.js"></script>
            <!-- Datatables -->
            <script src="~/vendors/datatables.net/js/jquery.dataTables.min.js"></script>
            @* <script src="~/lib/datatables/js/jquery.datatables.min.js"></script> *@
            <script src="~/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
            <script src="~/vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
            <script src="~/vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>
            <script src="~/vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>
            <script src="~/vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>
            <script src="~/vendors/datatables.net-buttons/js/buttons.print.min.js"></script>
            <script src="~/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>
            <script src="~/vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
            <script src="~/vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
            <script src="~/vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>
            <script src="~/vendors/datatables.net-scroller/js/dataTables.scroller.min.js"></script>
            <script src="~/vendors/jszip/dist/jszip.min.js"></script>
            <script src="~/vendors/pdfmake/build/pdfmake.min.js"></script>
            <script src="~/vendors/pdfmake/build/vfs_fonts.js"></script>
            <!-- Switchery -->
            <script src="~/vendors/switchery/dist/switchery.min.js"></script>

        }

        <script>
            function hideshow() {
                var password = document.getElementById("password1");
                var slash = document.getElementById("slash");
                var eye = document.getElementById("eye");

                if (password.type === 'password') {
                    password.type = "text";
                    slash.style.display = "block";
                    eye.style.display = "none";
                }
                else {
                    password.type = "password";
                    slash.style.display = "none";
                    eye.style.display = "block";
                }

            }

            document.getElementById('closeButton').addEventListener('click', function () {
                clearForm();
            });

            document.getElementById('saveButton').addEventListener('click', function () {
                clearForm();
            });


            function clearForm() {
                document.getElementById('memberForm').reset();

            }

            async function handleButtonClick(memberId) {
                // 发送 AJAX 请求以获取部分视图

                const response = await fetch(`@Url.Content("~/Member/Member/MemberEdit")?memberId=${memberId}`)
                const data = response.text();
                console.log(data);

                const showplace = document.getElementById("memberedit");
                showplace.innerHTML = data;
                // $.get("/Member/MemberEdit", { memberId: memberId }, function (data) {
                //     // 在加载的部分视图中显示成员的编辑表单
                //     $("#partialContainer").html(data);
                // });
            }
            handleButtonClick();

        </script>
